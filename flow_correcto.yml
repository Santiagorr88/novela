version: 1

variables:
  pdf_folder: "output/pdf"
  book_number: 1
  chapter_prefix: "B1C"
  saga_title: "Chronicles_of_the_Sundering_Judgment"

flow:
- id: chapter_number
  type: python
  module: src.scripts.memory_io
  function: next_chapter_number
  args:
    book_no: "{{ book_number }}"

- id: narrator
  type: python
  module: src.scripts.test_nodes
  function: dummy_chapter

- id: translator
  type: python
  module: src.scripts.test_nodes
  function: dummy_translation

- id: title_line
  type: python
  module: src.scripts.title_utils
  function: extract_title_line
  inputs:
    markdown_text: "{{ narrator }}"

- id: title_only
  type: python
  module: src.scripts.title_utils
  function: extract_title_only
  inputs:
    h1_line: "{{ title_line }}"

- id: title_slug
  type: python
  module: src.scripts.title_utils
  function: slugify
  inputs:
    text: "{{ title_only }}"

- id: chapter_prefix_full
  type: python
  module: src.scripts.title_utils
  function: extract_prefix
  inputs:
    h1_line: "{{ title_line }}"

# Filename EN
- id: pdf_filename_en
  type: python
  module: src.scripts.path_utils
  function: build_filename_h1_style
  args:
    folder: "{{ cfg.pdf_folder }}"
    prefix: "{{ cfg.chapter_prefix }}{{ chapter_number }}"
    title: "{{ title_only }}"
    lang: "EN"

# Exportar PDF EN
- id: pdf_en
  type: python
  module: src.scripts.export_pdf
  function: md_to_pdf
  inputs:
    markdown_text: "{{ narrator }}"
    filename: "{{ pdf_filename_en }}"

# Filename ES (simulado para testeo)
- id: pdf_filename_es
  type: python
  module: src.scripts.path_utils
  function: build_filename_h1_style
  args:
    folder: "{{ cfg.pdf_folder }}"
    prefix: "{{ cfg.chapter_prefix }}{{ chapter_number }}"
    title: "{{ title_only }}"
    lang: "ES"

# Exportar PDF ES
- id: pdf_es
  type: python
  module: src.scripts.export_pdf
  function: md_to_pdf
  inputs:
    markdown_text: "{{ translator }}"
    filename: "{{ pdf_filename_es }}"
